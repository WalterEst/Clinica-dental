<app-nav-bar></app-nav-bar>

<section class="container">
  <div class="form-wrapper">
    <div class="form-header">
      <h2 class="form-title">Formulario Radiografía</h2>
      <p class="form-subtitle">Ingrese la información de la radiografía y el paciente por RUT</p>
    </div>

    <form [formGroup]="radiografiaForm" (ngSubmit)="onSubmit()" class="patient-form">

      <!-- RUT y Nombre del Paciente -->
      <div class="form-row paciente-rut-row">
        <div class="form-group rut-input-group">
          <label class="form-label" for="rutPaciente">RUT Paciente</label>
          <input
            class="form-input"
            id="rutPaciente"
            formControlName="rutPaciente"
            placeholder="Ej: 12345678-9"
            autocomplete="off"
          />
          <small *ngIf="buscandoPaciente">Buscando paciente...</small>
          <small *ngIf="pacienteNoEncontrado" class="mensaje-error">Paciente no encontrado</small>
        </div>

        <div class="form-group nombre-input-group">
          <label class="form-label">Paciente</label>
          <div class="form-input paciente-nombre-box">
            {{ pacienteNombreCompleto || 'No seleccionado' }}
          </div>
        </div>
      </div>

      <!-- Fecha de Toma -->
      <div class="form-row">
        <div class="form-group full-width">
          <label class="form-label" for="fecha_toma">Fecha de toma</label>
          <input class="form-input" id="fecha_toma" formControlName="fecha_toma" type="date" required />
        </div>
      </div>

      <!-- Archivo y Tipo -->
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="archivo">Archivo</label>
          <input
            class="form-input"
            id="archivo"
            type="file"
            (change)="onFileSelected($event)"
            accept="image/*,application/pdf"
          />
        </div>

        <div class="form-group">
          <label class="form-label" for="tipo">Tipo</label>
          <input class="form-input" id="tipo" formControlName="tipo" />
        </div>
      </div>

      <!-- Observaciones -->
      <div class="form-row">
        <div class="form-group full-width">
          <label class="form-label" for="observaciones">Observaciones</label>
          <textarea class="form-input" id="observaciones" formControlName="observaciones" rows="3"></textarea>
        </div>
      </div>

      <!-- Campo oculto para ID del paciente -->
      <input type="hidden" formControlName="id_paciente" />

      <!-- Botones -->
      <div class="form-actions">
        <button class="submit-btn" type="submit" [disabled]="radiografiaForm.invalid || buscandoPaciente">
          Guardar
        </button>
        <button class="submit-btn" type="button" (click)="cancelar()">Cancelar</button>
      </div>

      <!-- Mensajes de estado -->
      <div *ngIf="loading" class="mensaje-cargando">Guardando datos...</div>
      <div *ngIf="errorMessage" class="mensaje-error">{{ errorMessage }}</div>
    </form>
  </div>
</section>

<app-footer></app-footer>
